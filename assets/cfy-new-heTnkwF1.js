import{d as H,x as Q,y as X,I as Y,q as ee,r as b,Z as te,k as ne,w as R,ax as oe,j as ae,L as re,b as v,a1 as se,N as j,a0 as ie,A as le,u as x,i as ce,ay as z,g as L,l as y,a as P,t as U,c as G,e as C,F as ue,m as de,o as B}from"./index-mUJzLBod.js";import{C as fe}from"./index-C4gHdpaL.js";import{E as me}from"./index-MdQwncYD.js";import{I as ve}from"./index-CWkQuqCH.js";import{F as _e}from"./index-D3Bw3iE2.js";import{_ as pe}from"./narback.vue_vue_type_script_setup_true_lang-C0uXjT3C.js";import{r as he}from"./request-CugEvBXe.js";import{L as Z,s as I}from"./function-call-BF_XnuIN.js";import{u as we}from"./use-expose-BV3qCCX3.js";import{a as ge}from"./use-tab-status-B-SIdkGQ.js";import{B as ye}from"./index-BhqpO9u8.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-route-BgGpYDbH.js";import"./index-B9T57ikj.js";import"./use-id-DN49xD3e.js";import"./use-placeholder-DaBMcbUy.js";import"./on-popup-reopen-DQPs8ALA.js";import"./index-BItfs3mF.js";import"./use-scope-id-Bt9atoQL.js";import"./interceptor-CczNA4uj.js";const[be,S,Te]=ee("list"),ke={error:Boolean,offset:Y(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:X("down"),loadingText:String,finishedText:String,immediateCheck:Q};var Pe=H({name:be,props:ke,emits:["load","update:error","update:loading"],setup(e,{emit:t,slots:s}){const c=b(e.loading),h=b(),T=b(),f=ge(),w=te(h),g=ne(()=>e.scroller||w.value),_=()=>{se(()=>{if(c.value||e.finished||e.disabled||e.error||(f==null?void 0:f.value)===!1)return;const{direction:r}=e,u=+e.offset,l=j(g);if(!l.height||ie(h))return;let i=!1;const m=j(T);r==="up"?i=l.top-m.top<=u:i=m.bottom-l.bottom<=u,i&&(c.value=!0,t("update:loading",!0),t("load"))})},p=()=>{if(e.finished){const r=s.finished?s.finished():e.finishedText;if(r)return v("div",{class:S("finished-text")},[r])}},n=()=>{t("update:error",!1),_()},o=()=>{if(e.error){const r=s.error?s.error():e.errorText;if(r)return v("div",{role:"button",class:S("error-text"),tabindex:0,onClick:n},[r])}},a=()=>{if(c.value&&!e.finished&&!e.disabled)return v("div",{class:S("loading")},[s.loading?s.loading():v(Z,{class:S("loading-icon")},{default:()=>[e.loadingText||Te("loading")]})])};return R(()=>[e.loading,e.finished,e.error],_),f&&R(f,r=>{r&&_()}),oe(()=>{c.value=e.loading}),ae(()=>{e.immediateCheck&&_()}),we({check:_}),re("scroll",_,{target:g,passive:!0}),()=>{var r;const u=(r=s.default)==null?void 0:r.call(s),l=v("div",{ref:T,class:S("placeholder")},null);return v("div",{ref:h,role:"feed",class:S(),"aria-busy":c.value},[e.direction==="down"?u:l,a(),p(),o(),e.direction==="up"?u:l])}}});const Be=le(Pe),Se="https://tb.anova.me",Ne=e=>he({url:Se+"/getPostsNew",method:"get",params:e});function A(e){return typeof e=="function"?e():x(e)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const J=()=>{};function V(e,t=!1,s="Timeout"){return new Promise((c,h)=>{setTimeout(t?()=>h(s):c,e)})}function q(e,t=!1){function s(n,{flush:o="sync",deep:a=!1,timeout:r,throwOnTimeout:u}={}){let l=null;const m=[new Promise(k=>{l=R(e,d=>{n(d)!==t&&(l==null||l(),k(d))},{flush:o,deep:a,immediate:!0})})];return r!=null&&m.push(V(r,u).then(()=>A(e)).finally(()=>l==null?void 0:l())),Promise.race(m)}function c(n,o){if(!ce(n))return s(d=>d===n,o);const{flush:a="sync",deep:r=!1,timeout:u,throwOnTimeout:l}=o??{};let i=null;const k=[new Promise(d=>{i=R([e,n],([E,F])=>{t!==(E===F)&&(i==null||i(),d(E))},{flush:a,deep:r,immediate:!0})})];return u!=null&&k.push(V(u,l).then(()=>A(e)).finally(()=>(i==null||i(),A(e)))),Promise.race(k)}function h(n){return s(o=>!!o,n)}function T(n){return c(null,n)}function f(n){return c(void 0,n)}function w(n){return s(Number.isNaN,n)}function g(n,o){return s(a=>{const r=Array.from(a);return r.includes(n)||r.includes(A(n))},o)}function _(n){return p(1,n)}function p(n=1,o){let a=-1;return s(()=>(a+=1,a>=n),o)}return Array.isArray(A(e))?{toMatch:s,toContains:g,changed:_,changedTimes:p,get not(){return q(e,!t)}}:{toMatch:s,toBe:c,toBeTruthy:h,toBeNull:T,toBeNaN:w,toBeUndefined:f,changed:_,changedTimes:p,get not(){return q(e,!t)}}}function Ce(e){return q(e)}function Ae(e,t,s){const{immediate:c=!0,delay:h=0,onError:T=J,onSuccess:f=J,resetOnExecute:w=!0,shallow:g=!0,throwError:_}=s??{},p=g?z(t):b(t),n=b(!1),o=b(!1),a=z(void 0);async function r(i=0,...m){w&&(p.value=t),a.value=void 0,n.value=!1,o.value=!0,i>0&&await V(i);const k=typeof e=="function"?e(...m):e;try{const d=await k;p.value=d,n.value=!0,f(d)}catch(d){if(a.value=d,T(d),_)throw d}finally{o.value=!1}return p.value}c&&r(h);const u={state:p,isReady:n,isLoading:o,error:a,execute:r};function l(){return new Promise((i,m)=>{Ce(o).toBe(!1).then(()=>i(u)).catch(m)})}return{...u,then(i,m){return l().then(i,m)}}}const M=typeof window<"u"?window.requestAnimationFrame:void 0,W=typeof window<"u"?window.cancelAnimationFrame:void 0,Ee=e=>{const t=Date.now();return setTimeout(()=>{e(Date.now()-t)},1e3/60)},Fe=e=>{clearTimeout(e)},Le=M?e=>M.call(window,e):Ee,Ie=W?e=>W.call(window,e):Fe;typeof window<"u"&&(window.requestAnimationFrame||(window.requestAnimationFrame=Le),window.cancelAnimationFrame||(window.cancelAnimationFrame=Ie));function O(e){const t=O._clone(e),s=b(e);function c(){s.value=O._clone(t)}return{state:s,resetState:c}}O._clone=function(e){return window&&"structuredClone"in window?structuredClone(e):JSON.parse(JSON.stringify(e))};const Re={class:"cfy_new"},Oe={class:"cfy_new_container"},Ue={class:"header"},Ve={class:"content"},qe={class:"user_container"},De={class:"user_name"},$e={class:"chatList"},je={key:0,class:"empty-or-loading-container"},ze={key:1,class:"empty-or-loading-container"},Ge={class:"content_title"},Je={class:"content_reply"},Me={class:"footer"},We=H({__name:"cfy-new",setup(e){const{state:t,resetState:s}=O({page:1,username:"",fname:void 0}),{state:c,execute:h}=Ae(()=>{const{page:o,username:a,fname:r}=t.value;return Ne({page:o,username:a,fname:r})},{msg:"",posts:[]},{resetOnExecute:!1,immediate:!1}),T=b("");let f=b({user:{nickname:"",avatar:""},posts:[]}),w=b(!1);const g=async()=>{if(!t.value.username.trim()){I("用户名不能为空");return}if(t.value.username.trim()==="回忆竟成空白"){I("该用户禁止搜索");return}try{w.value=!0;let o=await h();if(!o.msg.includes("Success")&&t.value.page>1&&(I(o.msg),T.value===t.value.username)){t.value.page--;return}f.value=c.value}catch{I("查询失败")}finally{w.value=!1,T.value=t.value.username}},_=()=>{t.value.page--,g()},p=()=>{t.value.page++,g()},n=o=>o?o.length>16?o.substring(0,12)+"...":o:"";return(o,a)=>{var F,D,$;const r=pe,u=ye,l=_e,i=ve,m=Z,k=me,d=fe,E=Be;return B(),L("div",Re,[v(r),y("div",Oe,[y("div",Ue,[v(l,{"label-width":"50",center:"",modelValue:x(t).username,"onUpdate:modelValue":a[0]||(a[0]=N=>x(t).username=N),label:"用户名",placeholder:"请输入用户名（注：非昵称）"},{button:P(()=>[v(u,{style:{width:"70px"},size:"small",plain:"",type:"primary",onClick:g},{default:P(()=>[...a[1]||(a[1]=[C("查询",-1)])]),_:1})]),_:1},8,["modelValue"])]),y("div",Ve,[y("div",qe,[v(i,{round:"",class:"user_img",src:(F=x(f).user)==null?void 0:F.avatar,alt:""},null,8,["src"]),y("div",De,U(((D=x(f).user)==null?void 0:D.nickname)||"用户名"),1)]),y("div",$e,[x(w)?(B(),L("div",je,[v(m,{size:"24px",vertical:""},{default:P(()=>[...a[2]||(a[2]=[C("加载中...",-1)])]),_:1})])):!x(w)&&(($=x(f).posts)==null?void 0:$.length)===0?(B(),L("div",ze,[v(k,{description:"暂无数据"})])):(B(),G(E,{key:2},{default:P(()=>[(B(!0),L(ue,null,de(x(f).posts,(N,K)=>(B(),G(d,{key:K,title:n(N.title)},{title:P(()=>[y("div",Ge,[a[3]||(a[3]=y("span",{class:"titleText"},"标题：",-1)),C(" "+U(N.title),1)])]),label:P(()=>[y("div",Je,U(N.content),1)]),_:2},1032,["title"]))),128))]),_:1}))])])]),y("div",Me,[v(u,{disabled:x(t).page==1,class:"footerItem",plain:"",type:"primary",onClick:_},{default:P(()=>[...a[4]||(a[4]=[C("上一页",-1)])]),_:1},8,["disabled"]),v(u,{class:"footerItem",plain:"",type:"primary",onClick:p},{default:P(()=>[...a[5]||(a[5]=[C("下一页",-1)])]),_:1})])])}}}),vt=xe(We,[["__scopeId","data-v-8098e280"]]);export{vt as default};
