import{d as Z,x as Y,y as ee,I as te,q as ne,r as b,Z as oe,k as ae,w as I,au as re,j as se,L as ie,b as p,a1 as le,N as z,a0 as ce,A as ue,u as x,i as de,av as G,g as F,l as y,a as P,t as U,c as J,e as N,F as fe,m as me,o as B}from"./index-Dm3XJQou.js";import{C as pe}from"./index-CUaE8eqv.js";import{E as he}from"./index-DW41dzNG.js";import{I as ve,a as _e}from"./index-CShAJoQM.js";import{F as ge}from"./index-drb4jYkT.js";import{_ as we}from"./narback.vue_vue_type_script_setup_true_lang-CSU9K6wn.js";import{r as ye}from"./request-UJ6iywIg.js";import{L as K,s as L}from"./function-call-zmZdu7iA.js";import{u as xe}from"./use-expose-vS_P2JAw.js";import{a as be}from"./use-tab-status-C969IK6s.js";import{B as ke}from"./index-BhEJRcLJ.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-route-BcEUn9xt.js";import"./index-DNtSWX2c.js";import"./use-id-ED1n7POZ.js";import"./use-placeholder-y9DvGg_K.js";import"./on-popup-reopen-CZFnVv-D.js";import"./interceptor-Cmlr3lpm.js";import"./index-nMPA-H1J.js";import"./use-scope-id-dXzTiNx8.js";const[Pe,S,Ce]=ne("list"),Be={error:Boolean,offset:te(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:ee("down"),loadingText:String,finishedText:String,immediateCheck:Y};var Se=Z({name:Pe,props:Be,emits:["load","update:error","update:loading"],setup(e,{emit:r,slots:t}){const c=b(e.loading),h=b(),k=b(),_=be(),g=oe(h),w=ae(()=>e.scroller||g.value),d=()=>{le(()=>{if(c.value||e.finished||e.disabled||e.error||(_==null?void 0:_.value)===!1)return;const{direction:n}=e,a=+e.offset,l=z(w);if(!l.height||ce(h))return;let s=!1;const m=z(k);n==="up"?s=l.top-m.top<=a:s=m.bottom-l.bottom<=a,s&&(c.value=!0,r("update:loading",!0),r("load"))})},v=()=>{if(e.finished){const n=t.finished?t.finished():e.finishedText;if(n)return p("div",{class:S("finished-text")},[n])}},o=()=>{r("update:error",!1),d()},i=()=>{if(e.error){const n=t.error?t.error():e.errorText;if(n)return p("div",{role:"button",class:S("error-text"),tabindex:0,onClick:o},[n])}},u=()=>{if(c.value&&!e.finished&&!e.disabled)return p("div",{class:S("loading")},[t.loading?t.loading():p(K,{class:S("loading-icon")},{default:()=>[e.loadingText||Ce("loading")]})])};return I(()=>[e.loading,e.finished,e.error],d),_&&I(_,n=>{n&&d()}),re(()=>{c.value=e.loading}),se(()=>{e.immediateCheck&&d()}),xe({check:d}),ie("scroll",d,{target:w,passive:!0}),()=>{var n;const a=(n=t.default)==null?void 0:n.call(t),l=p("div",{ref:k,class:S("placeholder")},null);return p("div",{ref:h,role:"feed",class:S(),"aria-busy":c.value},[e.direction==="down"?a:l,u(),v(),i(),e.direction==="up"?a:l])}}});const Ne=ue(Se),Ae="https://tb.anova.me",Ee=e=>{const{page:r=1,username:t="",fname:c="",baseProxy:h="https://api.allorigins.win/raw?url="}=e;return ye({method:"get",url:`${h}${encodeURIComponent(Ae+`/getPostsNew?page=${r}&username=${t}&fname=${c}`)}`})};function A(e){return typeof e=="function"?e():x(e)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const M=()=>{};function D(e,r=!1,t="Timeout"){return new Promise((c,h)=>{setTimeout(r?()=>h(t):c,e)})}function O(e,r=!1){function t(o,{flush:i="sync",deep:u=!1,timeout:n,throwOnTimeout:a}={}){let l=null;const m=[new Promise(T=>{l=I(e,f=>{o(f)!==r&&(l==null||l(),T(f))},{flush:i,deep:u,immediate:!0})})];return n!=null&&m.push(D(n,a).then(()=>A(e)).finally(()=>l==null?void 0:l())),Promise.race(m)}function c(o,i){if(!de(o))return t(f=>f===o,i);const{flush:u="sync",deep:n=!1,timeout:a,throwOnTimeout:l}=i??{};let s=null;const T=[new Promise(f=>{s=I([e,o],([E,$])=>{r!==(E===$)&&(s==null||s(),f(E))},{flush:u,deep:n,immediate:!0})})];return a!=null&&T.push(D(a,l).then(()=>A(e)).finally(()=>(s==null||s(),A(e)))),Promise.race(T)}function h(o){return t(i=>!!i,o)}function k(o){return c(null,o)}function _(o){return c(void 0,o)}function g(o){return t(Number.isNaN,o)}function w(o,i){return t(u=>{const n=Array.from(u);return n.includes(o)||n.includes(A(o))},i)}function d(o){return v(1,o)}function v(o=1,i){let u=-1;return t(()=>(u+=1,u>=o),i)}return Array.isArray(A(e))?{toMatch:t,toContains:w,changed:d,changedTimes:v,get not(){return O(e,!r)}}:{toMatch:t,toBe:c,toBeTruthy:h,toBeNull:k,toBeNaN:g,toBeUndefined:_,changed:d,changedTimes:v,get not(){return O(e,!r)}}}function Fe(e){return O(e)}function Le(e,r,t){const{immediate:c=!0,delay:h=0,onError:k=M,onSuccess:_=M,resetOnExecute:g=!0,shallow:w=!0,throwError:d}=t??{},v=w?G(r):b(r),o=b(!1),i=b(!1),u=G(void 0);async function n(s=0,...m){g&&(v.value=r),u.value=void 0,o.value=!1,i.value=!0,s>0&&await D(s);const T=typeof e=="function"?e(...m):e;try{const f=await T;v.value=f,o.value=!0,_(f)}catch(f){if(u.value=f,k(f),d)throw f}finally{i.value=!1}return v.value}c&&n(h);const a={state:v,isReady:o,isLoading:i,error:u,execute:n};function l(){return new Promise((s,m)=>{Fe(i).toBe(!1).then(()=>s(a)).catch(m)})}return{...a,then(s,m){return l().then(s,m)}}}const W=typeof window<"u"?window.requestAnimationFrame:void 0,H=typeof window<"u"?window.cancelAnimationFrame:void 0,Ie=e=>{const r=Date.now();return setTimeout(()=>{e(Date.now()-r)},1e3/60)},Re=e=>{clearTimeout(e)},$e=W?e=>W.call(window,e):Ie,Ue=H?e=>H.call(window,e):Re;typeof window<"u"&&(window.requestAnimationFrame||(window.requestAnimationFrame=$e),window.cancelAnimationFrame||(window.cancelAnimationFrame=Ue));function R(e){const r=R._clone(e),t=b(e);function c(){t.value=R._clone(r)}return{state:t,resetState:c}}R._clone=function(e){return window&&"structuredClone"in window?structuredClone(e):JSON.parse(JSON.stringify(e))};const De={class:"cfy_new"},Oe={class:"cfy_new_container"},Ve={class:"header"},qe={class:"content"},je={class:"user_container"},ze={class:"user_name"},Ge={class:"chatList"},Je={key:0,class:"empty-or-loading-container"},Me={key:1,class:"empty-or-loading-container"},We=["onClick"],He={class:"content_reply"},Ze={class:"footer"},Ke=Z({__name:"cfy-new",setup(e){const r=["https://corsproxy.io/?","https://api.codetabs.com/v1/proxy?quest=","https://thingproxy.freeboard.io/fetch/","https://api.allorigins.win/raw?url=","https://proxy.cors.sh/?"],{state:t,resetState:c}=R({page:1,username:"",fname:void 0}),{state:h,execute:k}=Le(()=>{const{page:n,username:a,fname:l}=t.value;return Ee({page:n,username:a,fname:l,baseProxy:r[1]})},{msg:"",posts:[]},{resetOnExecute:!1,immediate:!1,throwError:!0}),_=b("");let g=b({user:{nickname:"",avatar:""},posts:[]}),w=b(!1);const d=async()=>{if(!t.value.username.trim()){L("用户名不能为空");return}if(t.value.username.trim()==="回忆竟成空白"){L("该用户禁止搜索");return}try{w.value=!0;let n=await k();if(!n.msg.includes("Success")){if(L(n.msg),_.value===t.value.username&&t.value.page>1){t.value.page--;return}return}g.value=h.value}catch{t.value.page>1&&t.value.page--,L("代理服务器不稳定，请重试,当前代理: "+r[1])}finally{w.value=!1,_.value=t.value.username}},v=()=>{t.value.page--,d()},o=()=>{t.value.page++,d()},i=(n,a)=>{_e({title:"是否要跳转到以下详情",message:a}).then(()=>{window.open(n,"_blank")}).catch(()=>{})},u=n=>n?n.length>16?n.substring(0,12)+"...":n:"";return(n,a)=>{var V,q,j;const l=we,s=ke,m=ge,T=ve,f=K,E=he,$=pe,Q=Ne;return B(),F("div",De,[p(l),y("div",Oe,[y("div",Ve,[p(m,{"label-width":"50",center:"",modelValue:x(t).username,"onUpdate:modelValue":a[0]||(a[0]=C=>x(t).username=C),label:"用户名",placeholder:"请输入用户名（注：非昵称）"},{button:P(()=>[p(s,{style:{width:"70px"},size:"small",plain:"",type:"primary",onClick:d},{default:P(()=>[...a[1]||(a[1]=[N("查询",-1)])]),_:1})]),_:1},8,["modelValue"])]),y("div",qe,[y("div",je,[p(T,{round:"",class:"user_img",src:(V=x(g).user)==null?void 0:V.avatar,alt:""},null,8,["src"]),y("div",ze,U(((q=x(g).user)==null?void 0:q.nickname)||"用户名"),1)]),y("div",Ge,[x(w)?(B(),F("div",Je,[p(f,{size:"24px",vertical:""},{default:P(()=>[...a[2]||(a[2]=[N("加载中...",-1)])]),_:1})])):!x(w)&&((j=x(g).posts)==null?void 0:j.length)===0?(B(),F("div",Me,[p(E,{description:"暂无数据"})])):(B(),J(Q,{key:2},{default:P(()=>[(B(!0),F(fe,null,me(x(g).posts,(C,X)=>(B(),J($,{key:X,title:u(C.title)},{title:P(()=>[y("div",{class:"content_title",onClick:Qe=>i(C.href,C.title)},[a[3]||(a[3]=y("span",{class:"titleText"},"标题：",-1)),N(" "+U(C.title),1)],8,We)]),label:P(()=>[y("div",He,U(C.content),1)]),_:2},1032,["title"]))),128))]),_:1}))])])]),y("div",Ze,[p(s,{disabled:x(t).page==1,class:"footerItem",plain:"",type:"primary",onClick:v},{default:P(()=>[...a[4]||(a[4]=[N("上一页",-1)])]),_:1},8,["disabled"]),p(s,{class:"footerItem",plain:"",type:"primary",onClick:o},{default:P(()=>[...a[5]||(a[5]=[N("下一页",-1)])]),_:1})])])}}}),gt=Te(Ke,[["__scopeId","data-v-b423cf1f"]]);export{gt as default};
