import{d as M,x as Z,y as K,I as Q,q as X,r as P,Z as Y,k as ee,w as I,ax as te,j as ne,L as oe,b as _,a1 as ae,N as D,a0 as re,A as se,u as y,i as ie,ay as $,g as L,l as g,a as k,t as V,c as j,e as A,F as le,m as ce,o as B}from"./index-BSYCjbhw.js";import{C as ue}from"./index-stG9Tdo7.js";import{E as de}from"./index-yGQMP3np.js";import{I as fe}from"./index-CatU4Oqh.js";import{F as me}from"./index-CHgRCvKY.js";import{_ as _e}from"./narback.vue_vue_type_script_setup_true_lang-CdSWfj5w.js";import{r as pe}from"./request-CugEvBXe.js";import{L as W,s as O}from"./function-call-B8IDtOCi.js";import{u as he}from"./use-expose-B7TpWXOI.js";import{a as ve}from"./use-tab-status-DgG0U_OY.js";import{B as we}from"./index-gxEdBLqm.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-route-GHzG7f6I.js";import"./index-BmEXQvUh.js";import"./use-id-DcZ5DqZ9.js";import"./use-placeholder-DWevid9Z.js";import"./on-popup-reopen-BbNaH3CQ.js";import"./index-CUaYpwdY.js";import"./use-scope-id-D1-YQ1gv.js";import"./interceptor-BWk4zUg8.js";const[ye,S,xe]=X("list"),be={error:Boolean,offset:Q(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:K("down"),loadingText:String,finishedText:String,immediateCheck:Z};var Te=M({name:ye,props:be,emits:["load","update:error","update:loading"],setup(e,{emit:n,slots:o}){const i=P(e.loading),v=P(),w=P(),h=ve(),x=Y(v),b=ee(()=>e.scroller||x.value),p=()=>{ae(()=>{if(i.value||e.finished||e.disabled||e.error||(h==null?void 0:h.value)===!1)return;const{direction:a}=e,f=+e.offset,u=D(b);if(!u.height||re(v))return;let l=!1;const m=D(w);a==="up"?l=u.top-m.top<=f:l=m.bottom-u.bottom<=f,l&&(i.value=!0,n("update:loading",!0),n("load"))})},r=()=>{if(e.finished){const a=o.finished?o.finished():e.finishedText;if(a)return _("div",{class:S("finished-text")},[a])}},t=()=>{n("update:error",!1),p()},s=()=>{if(e.error){const a=o.error?o.error():e.errorText;if(a)return _("div",{role:"button",class:S("error-text"),tabindex:0,onClick:t},[a])}},c=()=>{if(i.value&&!e.finished&&!e.disabled)return _("div",{class:S("loading")},[o.loading?o.loading():_(W,{class:S("loading-icon")},{default:()=>[e.loadingText||xe("loading")]})])};return I(()=>[e.loading,e.finished,e.error],p),h&&I(h,a=>{a&&p()}),te(()=>{i.value=e.loading}),ne(()=>{e.immediateCheck&&p()}),he({check:p}),oe("scroll",p,{target:b,passive:!0}),()=>{var a;const f=(a=o.default)==null?void 0:a.call(o),u=_("div",{ref:w,class:S("placeholder")},null);return _("div",{ref:v,role:"feed",class:S(),"aria-busy":i.value},[e.direction==="down"?f:u,c(),r(),s(),e.direction==="up"?f:u])}}});const ke=se(Te),Pe="/tbapi",Be=e=>pe({url:Pe+"/getPostsNew",method:"get",params:e});function E(e){return typeof e=="function"?e():y(e)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const z=()=>{};function U(e,n=!1,o="Timeout"){return new Promise((i,v)=>{setTimeout(n?()=>v(o):i,e)})}function q(e,n=!1){function o(t,{flush:s="sync",deep:c=!1,timeout:a,throwOnTimeout:f}={}){let u=null;const m=[new Promise(T=>{u=I(e,d=>{t(d)!==n&&(u==null||u(),T(d))},{flush:s,deep:c,immediate:!0})})];return a!=null&&m.push(U(a,f).then(()=>E(e)).finally(()=>u==null?void 0:u())),Promise.race(m)}function i(t,s){if(!ie(t))return o(d=>d===t,s);const{flush:c="sync",deep:a=!1,timeout:f,throwOnTimeout:u}=s??{};let l=null;const T=[new Promise(d=>{l=I([e,t],([N,F])=>{n!==(N===F)&&(l==null||l(),d(N))},{flush:c,deep:a,immediate:!0})})];return f!=null&&T.push(U(f,u).then(()=>E(e)).finally(()=>(l==null||l(),E(e)))),Promise.race(T)}function v(t){return o(s=>!!s,t)}function w(t){return i(null,t)}function h(t){return i(void 0,t)}function x(t){return o(Number.isNaN,t)}function b(t,s){return o(c=>{const a=Array.from(c);return a.includes(t)||a.includes(E(t))},s)}function p(t){return r(1,t)}function r(t=1,s){let c=-1;return o(()=>(c+=1,c>=t),s)}return Array.isArray(E(e))?{toMatch:o,toContains:b,changed:p,changedTimes:r,get not(){return q(e,!n)}}:{toMatch:o,toBe:i,toBeTruthy:v,toBeNull:w,toBeNaN:x,toBeUndefined:h,changed:p,changedTimes:r,get not(){return q(e,!n)}}}function Se(e){return q(e)}function Ne(e,n,o){const{immediate:i=!0,delay:v=0,onError:w=z,onSuccess:h=z,resetOnExecute:x=!0,shallow:b=!0,throwError:p}=o??{},r=b?$(n):P(n),t=P(!1),s=P(!1),c=$(void 0);async function a(l=0,...m){x&&(r.value=n),c.value=void 0,t.value=!1,s.value=!0,l>0&&await U(l);const T=typeof e=="function"?e(...m):e;try{const d=await T;r.value=d,t.value=!0,h(d)}catch(d){if(c.value=d,w(d),p)throw d}finally{s.value=!1}return r.value}i&&a(v);const f={state:r,isReady:t,isLoading:s,error:c,execute:a};function u(){return new Promise((l,m)=>{Se(s).toBe(!1).then(()=>l(f)).catch(m)})}return{...f,then(l,m){return u().then(l,m)}}}const G=typeof window<"u"?window.requestAnimationFrame:void 0,J=typeof window<"u"?window.cancelAnimationFrame:void 0,Ce=e=>{const n=Date.now();return setTimeout(()=>{e(Date.now()-n)},1e3/60)},Ae=e=>{clearTimeout(e)},Ee=G?e=>G.call(window,e):Ce,Fe=J?e=>J.call(window,e):Ae;typeof window<"u"&&(window.requestAnimationFrame||(window.requestAnimationFrame=Ee),window.cancelAnimationFrame||(window.cancelAnimationFrame=Fe));function R(e){const n=R._clone(e),o=P(e);function i(){o.value=R._clone(n)}return{state:o,resetState:i}}R._clone=function(e){return window&&"structuredClone"in window?structuredClone(e):JSON.parse(JSON.stringify(e))};const Le={class:"cfy_new"},Ie={class:"cfy_new_container"},Re={class:"header"},Ve={class:"content"},Oe={class:"user_container"},Ue={class:"user_name"},qe={class:"chatList"},De={key:0,class:"empty-or-loading-container"},$e={key:1,class:"empty-or-loading-container"},je={class:"content_title"},ze={class:"content_reply"},Ge={class:"footer"},Je=M({__name:"cfy-new",setup(e){const{state:n,resetState:o}=R({page:1,username:"",fname:void 0}),{state:i,execute:v}=Ne(()=>{const{page:r,username:t,fname:s}=n.value;return Be({page:r,username:t,fname:s})},{msg:"",posts:[]},{resetOnExecute:!1,immediate:!1});let w=P(!1);const h=async()=>{if(!n.value.username.trim()){O("用户名不能为空");return}if(n.value.username.trim()==="回忆竟成空白"){O("该用户禁止搜索");return}try{w.value=!0;let r=await v();r.msg.includes("Success")||(O(r.msg),x())}catch{}finally{w.value=!1}},x=()=>{n.value.page--,h()},b=()=>{n.value.page++,h()},p=r=>r?r.length>16?r.substring(0,12)+"...":r:"";return(r,t)=>{var d,N,F;const s=_e,c=we,a=me,f=fe,u=W,l=de,m=ue,T=ke;return B(),L("div",Le,[_(s),g("div",Ie,[g("div",Re,[_(a,{"label-width":"50",center:"",modelValue:y(n).username,"onUpdate:modelValue":t[0]||(t[0]=C=>y(n).username=C),label:"用户名",placeholder:"请输入用户名（注：非昵称）"},{button:k(()=>[_(c,{style:{width:"70px"},size:"small",plain:"",type:"primary",onClick:h},{default:k(()=>[...t[1]||(t[1]=[A("查询",-1)])]),_:1})]),_:1},8,["modelValue"])]),g("div",Ve,[g("div",Oe,[_(f,{round:"",class:"user_img",src:(d=y(i).user)==null?void 0:d.avatar,alt:""},null,8,["src"]),g("div",Ue,V(((N=y(i).user)==null?void 0:N.nickname)||"用户名"),1)]),g("div",qe,[y(w)?(B(),L("div",De,[_(u,{size:"24px",vertical:""},{default:k(()=>[...t[2]||(t[2]=[A("加载中...",-1)])]),_:1})])):!y(w)&&((F=y(i).posts)==null?void 0:F.length)===0?(B(),L("div",$e,[_(l,{description:"暂无数据"})])):(B(),j(T,{key:2},{default:k(()=>[(B(!0),L(le,null,ce(y(i).posts,(C,H)=>(B(),j(m,{key:H,title:p(C.title)},{title:k(()=>[g("div",je,[t[3]||(t[3]=g("span",{class:"titleText"},"标题：",-1)),A(" "+V(C.title),1)])]),label:k(()=>[g("div",ze,V(C.content),1)]),_:2},1032,["title"]))),128))]),_:1}))])])]),g("div",Ge,[_(c,{disabled:y(n).page==1,class:"footerItem",plain:"",type:"primary",onClick:x},{default:k(()=>[...t[4]||(t[4]=[A("上一页",-1)])]),_:1},8,["disabled"]),_(c,{class:"footerItem",plain:"",type:"primary",onClick:b},{default:k(()=>[...t[5]||(t[5]=[A("下一页",-1)])]),_:1})])])}}}),ft=ge(Je,[["__scopeId","data-v-f52a3b01"]]);export{ft as default};
