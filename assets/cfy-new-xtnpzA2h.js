import{d as H,x as Q,y as X,I as Y,q as ee,r as b,Z as te,k as ne,w as R,ax as oe,j as ae,L as re,b as v,a1 as se,N as j,a0 as ie,A as le,u as x,i as ce,ay as z,g as L,l as y,a as P,t as O,c as G,e as N,F as ue,m as de,o as B}from"./index-survHpWT.js";import{C as fe}from"./index-sCVxG8gt.js";import{E as me}from"./index-BmEt20en.js";import{I as ve}from"./index-Dc5JV1k-.js";import{F as pe}from"./index-CdmCVcwx.js";import{_ as _e}from"./narback.vue_vue_type_script_setup_true_lang-czZ3hwtL.js";import{r as he}from"./request-CugEvBXe.js";import{L as Z,s as I}from"./function-call-DOIE706b.js";import{u as ge}from"./use-expose-otVHvhNW.js";import{a as we}from"./use-tab-status-B6SggB4x.js";import{B as ye}from"./index-DwZA5ZyI.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-route-Bpn2hXwb.js";import"./index-CAi7bDZT.js";import"./use-id-eQdHnsmN.js";import"./use-placeholder-BNrcfH1B.js";import"./on-popup-reopen-DBAOnjVv.js";import"./index-qzR_13pq.js";import"./use-scope-id-uGnyAdZx.js";import"./interceptor-B1QOqJHF.js";const[be,S,Te]=ee("list"),ke={error:Boolean,offset:Y(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:X("down"),loadingText:String,finishedText:String,immediateCheck:Q};var Pe=H({name:be,props:ke,emits:["load","update:error","update:loading"],setup(e,{emit:t,slots:s}){const c=b(e.loading),h=b(),T=b(),f=we(),g=te(h),w=ne(()=>e.scroller||g.value),p=()=>{se(()=>{if(c.value||e.finished||e.disabled||e.error||(f==null?void 0:f.value)===!1)return;const{direction:r}=e,u=+e.offset,l=j(w);if(!l.height||ie(h))return;let i=!1;const m=j(T);r==="up"?i=l.top-m.top<=u:i=m.bottom-l.bottom<=u,i&&(c.value=!0,t("update:loading",!0),t("load"))})},_=()=>{if(e.finished){const r=s.finished?s.finished():e.finishedText;if(r)return v("div",{class:S("finished-text")},[r])}},n=()=>{t("update:error",!1),p()},o=()=>{if(e.error){const r=s.error?s.error():e.errorText;if(r)return v("div",{role:"button",class:S("error-text"),tabindex:0,onClick:n},[r])}},a=()=>{if(c.value&&!e.finished&&!e.disabled)return v("div",{class:S("loading")},[s.loading?s.loading():v(Z,{class:S("loading-icon")},{default:()=>[e.loadingText||Te("loading")]})])};return R(()=>[e.loading,e.finished,e.error],p),f&&R(f,r=>{r&&p()}),oe(()=>{c.value=e.loading}),ae(()=>{e.immediateCheck&&p()}),ge({check:p}),re("scroll",p,{target:w,passive:!0}),()=>{var r;const u=(r=s.default)==null?void 0:r.call(s),l=v("div",{ref:T,class:S("placeholder")},null);return v("div",{ref:h,role:"feed",class:S(),"aria-busy":c.value},[e.direction==="down"?u:l,a(),_(),o(),e.direction==="up"?u:l])}}});const Be=le(Pe),Se="https://tb.anova.me",Ce=e=>he({url:`https://api.allorigins.win/raw?url=${encodeURIComponent(Se+`/getPostsNew?page=${e.page}&username=${e.username}&fname=${e.fname}`)}`,method:"get"});function A(e){return typeof e=="function"?e():x(e)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const J=()=>{};function V(e,t=!1,s="Timeout"){return new Promise((c,h)=>{setTimeout(t?()=>h(s):c,e)})}function $(e,t=!1){function s(n,{flush:o="sync",deep:a=!1,timeout:r,throwOnTimeout:u}={}){let l=null;const m=[new Promise(k=>{l=R(e,d=>{n(d)!==t&&(l==null||l(),k(d))},{flush:o,deep:a,immediate:!0})})];return r!=null&&m.push(V(r,u).then(()=>A(e)).finally(()=>l==null?void 0:l())),Promise.race(m)}function c(n,o){if(!ce(n))return s(d=>d===n,o);const{flush:a="sync",deep:r=!1,timeout:u,throwOnTimeout:l}=o??{};let i=null;const k=[new Promise(d=>{i=R([e,n],([E,F])=>{t!==(E===F)&&(i==null||i(),d(E))},{flush:a,deep:r,immediate:!0})})];return u!=null&&k.push(V(u,l).then(()=>A(e)).finally(()=>(i==null||i(),A(e)))),Promise.race(k)}function h(n){return s(o=>!!o,n)}function T(n){return c(null,n)}function f(n){return c(void 0,n)}function g(n){return s(Number.isNaN,n)}function w(n,o){return s(a=>{const r=Array.from(a);return r.includes(n)||r.includes(A(n))},o)}function p(n){return _(1,n)}function _(n=1,o){let a=-1;return s(()=>(a+=1,a>=n),o)}return Array.isArray(A(e))?{toMatch:s,toContains:w,changed:p,changedTimes:_,get not(){return $(e,!t)}}:{toMatch:s,toBe:c,toBeTruthy:h,toBeNull:T,toBeNaN:g,toBeUndefined:f,changed:p,changedTimes:_,get not(){return $(e,!t)}}}function Ne(e){return $(e)}function Ae(e,t,s){const{immediate:c=!0,delay:h=0,onError:T=J,onSuccess:f=J,resetOnExecute:g=!0,shallow:w=!0,throwError:p}=s??{},_=w?z(t):b(t),n=b(!1),o=b(!1),a=z(void 0);async function r(i=0,...m){g&&(_.value=t),a.value=void 0,n.value=!1,o.value=!0,i>0&&await V(i);const k=typeof e=="function"?e(...m):e;try{const d=await k;_.value=d,n.value=!0,f(d)}catch(d){if(a.value=d,T(d),p)throw d}finally{o.value=!1}return _.value}c&&r(h);const u={state:_,isReady:n,isLoading:o,error:a,execute:r};function l(){return new Promise((i,m)=>{Ne(o).toBe(!1).then(()=>i(u)).catch(m)})}return{...u,then(i,m){return l().then(i,m)}}}const M=typeof window<"u"?window.requestAnimationFrame:void 0,W=typeof window<"u"?window.cancelAnimationFrame:void 0,Ee=e=>{const t=Date.now();return setTimeout(()=>{e(Date.now()-t)},1e3/60)},Fe=e=>{clearTimeout(e)},Le=M?e=>M.call(window,e):Ee,Ie=W?e=>W.call(window,e):Fe;typeof window<"u"&&(window.requestAnimationFrame||(window.requestAnimationFrame=Le),window.cancelAnimationFrame||(window.cancelAnimationFrame=Ie));function U(e){const t=U._clone(e),s=b(e);function c(){s.value=U._clone(t)}return{state:s,resetState:c}}U._clone=function(e){return window&&"structuredClone"in window?structuredClone(e):JSON.parse(JSON.stringify(e))};const Re={class:"cfy_new"},Ue={class:"cfy_new_container"},Oe={class:"header"},Ve={class:"content"},$e={class:"user_container"},qe={class:"user_name"},De={class:"chatList"},je={key:0,class:"empty-or-loading-container"},ze={key:1,class:"empty-or-loading-container"},Ge={class:"content_title"},Je={class:"content_reply"},Me={class:"footer"},We=H({__name:"cfy-new",setup(e){const{state:t,resetState:s}=U({page:1,username:"",fname:void 0}),{state:c,execute:h}=Ae(()=>{const{page:o,username:a,fname:r}=t.value;return Ce({page:o,username:a,fname:r})},{msg:"",posts:[]},{resetOnExecute:!1,immediate:!1}),T=b("");let f=b({user:{nickname:"",avatar:""},posts:[]}),g=b(!1);const w=async()=>{if(!t.value.username.trim()){I("用户名不能为空");return}if(t.value.username.trim()==="回忆竟成空白"){I("该用户禁止搜索");return}try{g.value=!0;let o=await h();if(!o.msg.includes("Success")){if(I(o.msg),T.value===t.value.username&&t.value.page>1){t.value.page--;return}return}f.value=c.value}catch{t.value.page>1&&t.value.page--,I("查询失败，请联系管理")}finally{g.value=!1,T.value=t.value.username}},p=()=>{t.value.page--,w()},_=()=>{t.value.page++,w()},n=o=>o?o.length>16?o.substring(0,12)+"...":o:"";return(o,a)=>{var F,q,D;const r=_e,u=ye,l=pe,i=ve,m=Z,k=me,d=fe,E=Be;return B(),L("div",Re,[v(r),y("div",Ue,[y("div",Oe,[v(l,{"label-width":"50",center:"",modelValue:x(t).username,"onUpdate:modelValue":a[0]||(a[0]=C=>x(t).username=C),label:"用户名",placeholder:"请输入用户名（注：非昵称）"},{button:P(()=>[v(u,{style:{width:"70px"},size:"small",plain:"",type:"primary",onClick:w},{default:P(()=>[...a[1]||(a[1]=[N("查询",-1)])]),_:1})]),_:1},8,["modelValue"])]),y("div",Ve,[y("div",$e,[v(i,{round:"",class:"user_img",src:(F=x(f).user)==null?void 0:F.avatar,alt:""},null,8,["src"]),y("div",qe,O(((q=x(f).user)==null?void 0:q.nickname)||"用户名"),1)]),y("div",De,[x(g)?(B(),L("div",je,[v(m,{size:"24px",vertical:""},{default:P(()=>[...a[2]||(a[2]=[N("加载中...",-1)])]),_:1})])):!x(g)&&((D=x(f).posts)==null?void 0:D.length)===0?(B(),L("div",ze,[v(k,{description:"暂无数据"})])):(B(),G(E,{key:2},{default:P(()=>[(B(!0),L(ue,null,de(x(f).posts,(C,K)=>(B(),G(d,{key:K,title:n(C.title)},{title:P(()=>[y("div",Ge,[a[3]||(a[3]=y("span",{class:"titleText"},"标题：",-1)),N(" "+O(C.title),1)])]),label:P(()=>[y("div",Je,O(C.content),1)]),_:2},1032,["title"]))),128))]),_:1}))])])]),y("div",Me,[v(u,{disabled:x(t).page==1,class:"footerItem",plain:"",type:"primary",onClick:p},{default:P(()=>[...a[4]||(a[4]=[N("上一页",-1)])]),_:1},8,["disabled"]),v(u,{class:"footerItem",plain:"",type:"primary",onClick:_},{default:P(()=>[...a[5]||(a[5]=[N("下一页",-1)])]),_:1})])])}}}),vt=xe(We,[["__scopeId","data-v-93cc1ef6"]]);export{vt as default};
