import{d as Z,x as ee,y as te,I as ne,q as oe,r as x,Z as ae,k as re,w as L,au as se,j as ie,L as le,b as h,a1 as ce,N as z,a0 as ue,A as de,u as y,i as fe,av as G,g as F,l as g,a as P,t as $,c as J,e as N,F as me,m as pe,o as B}from"./index-BcmBz-3v.js";import{C as he}from"./index-Cs-won2j.js";import{E as ve}from"./index-Bz5MEIh7.js";import{I as _e,a as we}from"./index-WCrc0J_1.js";import{F as ge}from"./index-BEkQcqgs.js";import{_ as ye}from"./narback.vue_vue_type_script_setup_true_lang-C3Vgv0jC.js";import{r as xe}from"./request-vqzHaIA8.js";import{L as K,s as U,b as be}from"./function-call-DPzwNvGn.js";import{u as ke}from"./use-expose-CJLuzQjk.js";import{a as Te}from"./use-tab-status-Cyg9gaQe.js";import{B as Pe}from"./index-5eYX_Fks.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-route-D5E7MjTX.js";import"./index-C5Fcd7RL.js";import"./use-id-B6E0c3HK.js";import"./use-placeholder-ClU4AgVv.js";import"./on-popup-reopen-b_mukz0S.js";import"./interceptor-CN8ZFYrj.js";import"./index-DL3Fdz03.js";import"./use-scope-id-Cm6FhUjB.js";const[Be,S,Se]=oe("list"),Ne={error:Boolean,offset:ne(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:te("down"),loadingText:String,finishedText:String,immediateCheck:ee};var Ae=Z({name:Be,props:Ne,emits:["load","update:error","update:loading"],setup(e,{emit:i,slots:a}){const n=x(e.loading),v=x(),b=x(),w=Te(),k=ae(v),_=re(()=>e.scroller||k.value),u=()=>{ce(()=>{if(n.value||e.finished||e.disabled||e.error||(w==null?void 0:w.value)===!1)return;const{direction:s}=e,r=+e.offset,t=z(_);if(!t.height||ue(v))return;let l=!1;const f=z(b);s==="up"?l=t.top-f.top<=r:l=f.bottom-t.bottom<=r,l&&(n.value=!0,i("update:loading",!0),i("load"))})},p=()=>{if(e.finished){const s=a.finished?a.finished():e.finishedText;if(s)return h("div",{class:S("finished-text")},[s])}},o=()=>{i("update:error",!1),u()},c=()=>{if(e.error){const s=a.error?a.error():e.errorText;if(s)return h("div",{role:"button",class:S("error-text"),tabindex:0,onClick:o},[s])}},d=()=>{if(n.value&&!e.finished&&!e.disabled)return h("div",{class:S("loading")},[a.loading?a.loading():h(K,{class:S("loading-icon")},{default:()=>[e.loadingText||Se("loading")]})])};return L(()=>[e.loading,e.finished,e.error],u),w&&L(w,s=>{s&&u()}),se(()=>{n.value=e.loading}),ie(()=>{e.immediateCheck&&u()}),ke({check:u}),le("scroll",u,{target:_,passive:!0}),()=>{var s;const r=(s=a.default)==null?void 0:s.call(a),t=h("div",{ref:b,class:S("placeholder")},null);return h("div",{ref:v,role:"feed",class:S(),"aria-busy":n.value},[e.direction==="down"?r:t,d(),p(),c(),e.direction==="up"?r:t])}}});const Ee=de(Ae),Fe="https://tb.anova.me",Le=e=>{const{page:i=1,username:a="",fname:n="",baseProxy:v="https://api.allorigins.win/raw?url="}=e;return xe({method:"get",url:`${v}${encodeURIComponent(Fe+`/getPostsNew?page=${i}&username=${a}&fname=${n}`)}`})};function A(e){return typeof e=="function"?e():y(e)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const M=()=>{};function D(e,i=!1,a="Timeout"){return new Promise((n,v)=>{setTimeout(i?()=>v(a):n,e)})}function O(e,i=!1){function a(o,{flush:c="sync",deep:d=!1,timeout:s,throwOnTimeout:r}={}){let t=null;const f=[new Promise(T=>{t=L(e,m=>{o(m)!==i&&(t==null||t(),T(m))},{flush:c,deep:d,immediate:!0})})];return s!=null&&f.push(D(s,r).then(()=>A(e)).finally(()=>t==null?void 0:t())),Promise.race(f)}function n(o,c){if(!fe(o))return a(m=>m===o,c);const{flush:d="sync",deep:s=!1,timeout:r,throwOnTimeout:t}=c??{};let l=null;const T=[new Promise(m=>{l=L([e,o],([E,R])=>{i!==(E===R)&&(l==null||l(),m(E))},{flush:d,deep:s,immediate:!0})})];return r!=null&&T.push(D(r,t).then(()=>A(e)).finally(()=>(l==null||l(),A(e)))),Promise.race(T)}function v(o){return a(c=>!!c,o)}function b(o){return n(null,o)}function w(o){return n(void 0,o)}function k(o){return a(Number.isNaN,o)}function _(o,c){return a(d=>{const s=Array.from(d);return s.includes(o)||s.includes(A(o))},c)}function u(o){return p(1,o)}function p(o=1,c){let d=-1;return a(()=>(d+=1,d>=o),c)}return Array.isArray(A(e))?{toMatch:a,toContains:_,changed:u,changedTimes:p,get not(){return O(e,!i)}}:{toMatch:a,toBe:n,toBeTruthy:v,toBeNull:b,toBeNaN:k,toBeUndefined:w,changed:u,changedTimes:p,get not(){return O(e,!i)}}}function Ie(e){return O(e)}function Re(e,i,a){const{immediate:n=!0,delay:v=0,onError:b=M,onSuccess:w=M,resetOnExecute:k=!0,shallow:_=!0,throwError:u}=a??{},p=_?G(i):x(i),o=x(!1),c=x(!1),d=G(void 0);async function s(l=0,...f){k&&(p.value=i),d.value=void 0,o.value=!1,c.value=!0,l>0&&await D(l);const T=typeof e=="function"?e(...f):e;try{const m=await T;p.value=m,o.value=!0,w(m)}catch(m){if(d.value=m,b(m),u)throw m}finally{c.value=!1}return p.value}n&&s(v);const r={state:p,isReady:o,isLoading:c,error:d,execute:s};function t(){return new Promise((l,f)=>{Ie(c).toBe(!1).then(()=>l(r)).catch(f)})}return{...r,then(l,f){return t().then(l,f)}}}const W=typeof window<"u"?window.requestAnimationFrame:void 0,H=typeof window<"u"?window.cancelAnimationFrame:void 0,$e=e=>{const i=Date.now();return setTimeout(()=>{e(Date.now()-i)},1e3/60)},Ue=e=>{clearTimeout(e)},De=W?e=>W.call(window,e):$e,Oe=H?e=>H.call(window,e):Ue;typeof window<"u"&&(window.requestAnimationFrame||(window.requestAnimationFrame=De),window.cancelAnimationFrame||(window.cancelAnimationFrame=Oe));function I(e){const i=I._clone(e),a=x(e);function n(){a.value=I._clone(i)}return{state:a,resetState:n}}I._clone=function(e){return window&&"structuredClone"in window?structuredClone(e):JSON.parse(JSON.stringify(e))};const Ve={class:"cfy_new"},qe={class:"cfy_new_container"},je={class:"header"},ze={class:"content"},Ge={class:"user_container"},Je={class:"user_name"},Me={class:"chatList"},We={key:0,class:"empty-or-loading-container"},He={key:1,class:"empty-or-loading-container"},Ze=["onClick"],Ke={class:"content_reply"},Qe={class:"footer"},Xe=Z({__name:"cfy-new",setup(e){let a=["https://corsproxy.io/?","https://api.codetabs.com/v1/proxy?quest=","https://thingproxy.freeboard.io/fetch/","https://api.allorigins.win/raw?url=","https://proxy.cors.sh/?"][3];const{state:n,resetState:v}=I({page:1,username:"",fname:void 0}),{state:b,execute:w}=Re(()=>{const{page:r,username:t,fname:l}=n.value;return Le({page:r,username:t,fname:l,baseProxy:a})},{msg:"",posts:[]},{resetOnExecute:!1,immediate:!1,throwError:!0}),k=x("");let _=x({user:{nickname:"",avatar:""},posts:[]}),u=x(!1);const p=async()=>{if(!n.value.username.trim()){U("用户名不能为空");return}if(n.value.username.trim()==="回忆竟成空白"){U("该用户禁止搜索");return}try{u.value=!0;let r=await w();if(!r.msg.includes("Success")){if(U(r.msg),k.value===n.value.username&&n.value.page>1){n.value.page--;return}return}_.value=b.value}catch{n.value.page>1&&n.value.page--,be({message:"代理服务器不稳定，请重试,当前代理: "+a,wordBreak:"break-word"})}finally{u.value=!1,k.value=n.value.username}},o=()=>{n.value.page--,p()},c=()=>{n.value.page++,p()},d=(r,t)=>{we({title:"是否要跳转到以下详情",message:t}).then(()=>{window.open(r,"_blank")}).catch(()=>{})},s=r=>r?r.length>16?r.substring(0,12)+"...":r:"";return(r,t)=>{var V,q,j;const l=ye,f=Pe,T=ge,m=_e,E=K,R=ve,Q=he,X=Ee;return B(),F("div",Ve,[h(l),g("div",qe,[g("div",je,[h(T,{"label-width":"50",center:"",modelValue:y(n).username,"onUpdate:modelValue":t[0]||(t[0]=C=>y(n).username=C),label:"用户名",placeholder:"请输入用户名（注：非昵称）"},{button:P(()=>[h(f,{style:{width:"70px"},size:"small",plain:"",type:"primary",onClick:p},{default:P(()=>[...t[1]||(t[1]=[N("查询",-1)])]),_:1})]),_:1},8,["modelValue"])]),g("div",ze,[g("div",Ge,[h(m,{round:"",class:"user_img",src:(V=y(_).user)==null?void 0:V.avatar,alt:""},null,8,["src"]),g("div",Je,$(((q=y(_).user)==null?void 0:q.nickname)||"用户名"),1)]),g("div",Me,[y(u)?(B(),F("div",We,[h(E,{size:"24px",vertical:""},{default:P(()=>[...t[2]||(t[2]=[N("加载中...",-1)])]),_:1})])):!y(u)&&((j=y(_).posts)==null?void 0:j.length)===0?(B(),F("div",He,[h(R,{description:"暂无数据"})])):(B(),J(X,{key:2},{default:P(()=>[(B(!0),F(me,null,pe(y(_).posts,(C,Y)=>(B(),J(Q,{key:Y,title:s(C.title)},{title:P(()=>[g("div",{class:"content_title",onClick:Ye=>d(C.href,C.title)},[t[3]||(t[3]=g("span",{class:"titleText"},"标题：",-1)),N(" "+$(C.title),1)],8,Ze)]),label:P(()=>[g("div",Ke,$(C.content),1)]),_:2},1032,["title"]))),128))]),_:1}))])])]),g("div",Qe,[h(f,{disabled:y(n).page==1,class:"footerItem",plain:"",type:"primary",onClick:o},{default:P(()=>[...t[4]||(t[4]=[N("上一页",-1)])]),_:1},8,["disabled"]),h(f,{class:"footerItem",plain:"",type:"primary",onClick:c},{default:P(()=>[...t[5]||(t[5]=[N("下一页",-1)])]),_:1})])])}}}),yt=Ce(Xe,[["__scopeId","data-v-87661da4"]]);export{yt as default};
